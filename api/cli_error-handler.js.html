<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: cli/error-handler.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: cli/error-handler.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * CLI error handler
 * 
 * Provides consistent error display for the CLI interface with detailed context
 * and troubleshooting information
 */

import chalk from 'chalk';
import { 
  GliaError, 
  ValidationError, 
  AuthenticationError, 
  ConfigurationError, 
  FunctionError,
  NetworkError,
  RateLimitError 
} from '../lib/errors.js';

/**
 * Format and display troubleshooting hints
 * 
 * @param {string[]} hints - Array of troubleshooting hints
 */
function displayTroubleshootingHints(hints) {
  if (!hints || hints.length === 0) return;
  
  console.error(chalk.yellow('\n‚ö†Ô∏è  Troubleshooting:'));
  hints.forEach(hint => {
    console.error(chalk.yellow('  ‚Ä¢ ') + hint);
  });
}

/**
 * Format and display request details for network-related errors
 * 
 * @param {GliaError} error - Error with request details
 * @param {boolean} verbose - Whether to show verbose error details
 */
function displayRequestDetails(error, verbose) {
  if (!verbose) return;
  
  console.error(chalk.gray('\nüì° Request Information:'));
  
  if (error.endpoint) {
    console.error(chalk.gray(`  Endpoint: ${error.method || 'GET'} ${error.endpoint}`));
  }
  
  if (error.statusCode) {
    console.error(chalk.gray(`  Status Code: ${error.statusCode}`));
  }
  
  if (error.requestId) {
    console.error(chalk.gray(`  Request ID: ${error.requestId}`));
  }
  
  if (error.timestamp) {
    console.error(chalk.gray(`  Timestamp: ${error.timestamp}`));
  }
  
  if (error.requestPayload &amp;&amp; verbose) {
    console.error(chalk.gray('  Request Payload:'));
    console.error(chalk.gray('  ' + JSON.stringify(error.requestPayload, null, 2)
      .replace(/\n/g, '\n  ')));
  }
  
  if (error.responseBody &amp;&amp; verbose) {
    console.error(chalk.gray('  Response Body:'));
    const response = typeof error.responseBody === 'string' 
      ? error.responseBody 
      : JSON.stringify(error.responseBody, null, 2);
    console.error(chalk.gray('  ' + response.replace(/\n/g, '\n  ')));
  }
}

/**
 * Display validation-specific error information
 * 
 * @param {ValidationError} error - Validation error with field details
 */
function displayValidationDetails(error) {
  if (error.field) {
    console.error(chalk.yellow(`  Field: ${error.field}`));
  }
  
  if (error.provided !== undefined) {
    const providedValue = typeof error.provided === 'object' 
      ? JSON.stringify(error.provided) 
      : String(error.provided);
    console.error(chalk.yellow(`  Provided: ${providedValue}`));
  }
  
  if (error.expected !== undefined) {
    const expectedValue = typeof error.expected === 'object' 
      ? JSON.stringify(error.expected) 
      : String(error.expected);
    console.error(chalk.yellow(`  Expected: ${expectedValue}`));
  }
}

/**
 * Handle an error in the CLI
 * 
 * @param {Error} error - The error to handle
 * @param {boolean} verbose - Whether to show verbose error details
 */
export function handleError(error, verbose = false) {
  if (error instanceof ValidationError) {
    console.error(chalk.red('‚ùå Validation Error:'), error.message);
    displayValidationDetails(error);
    
    // Display troubleshooting hints if any
    if (verbose &amp;&amp; error.details) {
      console.error(chalk.yellow('\nDetails:'));
      console.error(chalk.yellow(JSON.stringify(error.details, null, 2)));
    }
    
    process.exit(1);
  }
  
  if (error instanceof AuthenticationError) {
    console.error(chalk.red('üîí Authentication Error:'), error.message);
    
    // Display troubleshooting hints
    displayTroubleshootingHints(error.getTroubleshootingHints?.() || [
      'Try running: node index.js',
      'Then select "Authenticate CLI" from the main menu.'
    ]);
    
    // Display request details if relevant
    displayRequestDetails(error, verbose);
    
    process.exit(1);
  }
  
  if (error instanceof ConfigurationError) {
    console.error(chalk.red('‚öôÔ∏è  Configuration Error:'), error.message);
    
    // Display troubleshooting hints
    displayTroubleshootingHints(error.getTroubleshootingHints?.() || [
      'Try running: node index.js',
      'Then select "Setup project" from the main menu.'
    ]);
    
    if (error.missingFields?.length) {
      console.error(chalk.yellow('\nMissing Fields:'));
      error.missingFields.forEach(field => {
        console.error(chalk.yellow(`  ‚Ä¢ ${field}`));
      });
    }
    
    if (error.invalidFields?.length) {
      console.error(chalk.yellow('\nInvalid Fields:'));
      error.invalidFields.forEach(field => {
        console.error(chalk.yellow(`  ‚Ä¢ ${field}`));
      });
    }
    
    if (error.configFile) {
      console.error(chalk.yellow(`\nConfiguration File: ${error.configFile}`));
    }
    
    process.exit(1);
  }

  if (error instanceof FunctionError) {
    console.error(chalk.red('üõë Function Error:'), error.message);
    
    if (error.functionId) {
      console.error(chalk.yellow(`Function ID: ${error.functionId}`));
    }
    
    if (error.versionId) {
      console.error(chalk.yellow(`Version ID: ${error.versionId}`));
    }
    
    if (error.operation) {
      console.error(chalk.yellow(`Operation: ${error.operation}`));
    }
    
    // Display troubleshooting hints
    displayTroubleshootingHints(error.getTroubleshootingHints?.());
    
    // Display request details if relevant
    displayRequestDetails(error, verbose);
    
    process.exit(1);
  }
  
  if (error instanceof RateLimitError) {
    console.error(chalk.red('‚è±Ô∏è  Rate Limit Error:'), error.message);
    
    if (error.retryAfter) {
      console.error(chalk.yellow(`Retry after: ${error.retryAfter} seconds`));
    }
    
    if (error.limit) {
      console.error(chalk.yellow(`Rate limit: ${error.limit} requests`));
    }
    
    // Display troubleshooting hints
    displayTroubleshootingHints(error.getTroubleshootingHints?.());
    
    // Display request details if relevant
    displayRequestDetails(error, verbose);
    
    process.exit(1);
  }
  
  if (error instanceof NetworkError) {
    console.error(chalk.red('üì∂ Network Error:'), error.message);
    
    // Display troubleshooting hints
    displayTroubleshootingHints(error.getTroubleshootingHints?.() || [
      'Check your internet connection and try again.',
      'Verify the API endpoint is correct.',
      error.retryable ? 'This error is likely temporary. Try again later.' : null
    ].filter(Boolean));
    
    // Display request details if relevant
    displayRequestDetails(error, verbose);
    
    process.exit(1);
  }
  
  if (error instanceof GliaError) {
    console.error(chalk.red(`‚ùó Error (${error.code}):`), error.message);
    
    // Use formatWithContext if available, otherwise display basic details
    if (error.formatWithContext &amp;&amp; verbose) {
      const formattedError = error.formatWithContext();
      console.error(chalk.gray('\nError Context:'));
      console.error(chalk.gray(formattedError.split('\n').slice(1).join('\n')));
    } else if (error.details &amp;&amp; verbose) {
      console.error(chalk.yellow('\nDetails:'));
      console.error(chalk.yellow(JSON.stringify(error.details, null, 2)));
    }
    
    // Display request details if relevant
    displayRequestDetails(error, verbose);
    
    process.exit(1);
  }
  
  // Unexpected errors
  console.error(chalk.red('üí• Unexpected Error:'), error.message);
  if (verbose) {
    console.error(chalk.gray('\nStack Trace:'));
    console.error(chalk.gray(error.stack));
  } else {
    console.error(chalk.yellow('\nFor more details, run with --verbose flag.'));
  }
  process.exit(1);
}

/**
 * Display warning messages consistently
 * 
 * @param {string} message - Warning message to display
 */
export function showWarning(message) {
  console.warn(chalk.yellow('‚ö†Ô∏è  Warning:'), message);
}

/**
 * Display success messages consistently
 * 
 * @param {string} message - Success message to display
 */
export function showSuccess(message) {
  console.log(chalk.green('‚úÖ Success:'), message);
}

/**
 * Display info messages consistently
 * 
 * @param {string} message - Info message to display
 */
export function showInfo(message) {
  console.log(chalk.blue('‚ÑπÔ∏è  Info:'), message);
}

/**
 * Display error messages consistently
 * 
 * @param {string} message - Error message to display
 */
export function showError(message) {
  console.error(chalk.red('‚ùå Error:'), message);
}

/**
 * Display debug messages (only if verbose mode)
 * 
 * @param {string} message - Debug message to display
 * @param {boolean} verbose - Whether to show debug messages
 */
export function showDebug(message, verbose = false) {
  if (verbose) {
    console.log(chalk.gray('üîç Debug:'), message);
  }
}

/**
 * Format error details for display
 * 
 * @param {Error} error - Error to format
 * @param {boolean} verbose - Whether to include detailed information
 * @returns {string} Formatted error message
 */
export function formatErrorForDisplay(error, verbose = false) {
  if (error instanceof GliaError &amp;&amp; error.formatWithContext) {
    return error.formatWithContext();
  }
  
  let output = error.message;
  
  if (verbose &amp;&amp; error instanceof GliaError) {
    if (error.code) {
      output += `\nCode: ${error.code}`;
    }
    
    if (error.details) {
      output += `\nDetails: ${JSON.stringify(error.details, null, 2)}`;
    }
  }
  
  if (verbose &amp;&amp; error.stack) {
    output += `\n${error.stack.split('\n').slice(1).join('\n')}`;
  }
  
  return output;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-api.html">api</a></li><li><a href="module-config.html">config</a></li></ul><h3>Classes</h3><ul><li><a href="ApiError.html">ApiError</a></li><li><a href="AuthenticationError.html">AuthenticationError</a></li><li><a href="BaseCommand_BaseCommand.html">BaseCommand</a></li><li><a href="CircuitBreaker.html">CircuitBreaker</a></li><li><a href="ConfigurationError.html">ConfigurationError</a></li><li><a href="FunctionError.html">FunctionError</a></li><li><a href="GliaError.html">GliaError</a></li><li><a href="NetworkDetector.html">NetworkDetector</a></li><li><a href="NetworkError.html">NetworkError</a></li><li><a href="OfflineManager.html">OfflineManager</a></li><li><a href="OperationQueue.html">OperationQueue</a></li><li><a href="PersistentCacheStorage.html">PersistentCacheStorage</a></li><li><a href="RateLimitError.html">RateLimitError</a></li><li><a href="ResponseCache.html">ResponseCache</a></li><li><a href="ValidationError.html">ValidationError</a></li><li><a href="module-api.html">api</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CLIAuth">CLIAuth</a></li><li><a href="global.html#CLIBuildMenu">CLIBuildMenu</a></li><li><a href="global.html#CLICreateProfile">CLICreateProfile</a></li><li><a href="global.html#CLIDeleteProfile">CLIDeleteProfile</a></li><li><a href="global.html#CLIDeployFunction">CLIDeployFunction</a></li><li><a href="global.html#CLIDevFunction">CLIDevFunction</a></li><li><a href="global.html#CLIFunctionDetailsMenu">CLIFunctionDetailsMenu</a></li><li><a href="global.html#CLIFunctionInvoke">CLIFunctionInvoke</a></li><li><a href="global.html#CLIFunctionLogs">CLIFunctionLogs</a></li><li><a href="global.html#CLIFunctionVersion">CLIFunctionVersion</a></li><li><a href="global.html#CLIFunctionVersions">CLIFunctionVersions</a></li><li><a href="global.html#CLIInitProject">CLIInitProject</a></li><li><a href="global.html#CLIListFunctions">CLIListFunctions</a></li><li><a href="global.html#CLIListProfiles">CLIListProfiles</a></li><li><a href="global.html#CLIMainMenu">CLIMainMenu</a></li><li><a href="global.html#CLIManageEnvVars">CLIManageEnvVars</a></li><li><a href="global.html#CLINewFunction">CLINewFunction</a></li><li><a href="global.html#CLINewVersion">CLINewVersion</a></li><li><a href="global.html#CLIProfileMenu">CLIProfileMenu</a></li><li><a href="global.html#CLISetup">CLISetup</a></li><li><a href="global.html#CLISwitchProfile">CLISwitchProfile</a></li><li><a href="global.html#CLIUpdateEnvironment">CLIUpdateEnvironment</a></li><li><a href="global.html#CLIUpdateFunction">CLIUpdateFunction</a></li><li><a href="global.html#DEFAULT_CACHE_CONFIG">DEFAULT_CACHE_CONFIG</a></li><li><a href="global.html#DEFAULT_OFFLINE_CONFIG">DEFAULT_OFFLINE_CONFIG</a></li><li><a href="global.html#DEFAULT_RETRY_CONFIG">DEFAULT_RETRY_CONFIG</a></li><li><a href="global.html#calculateBackoffDelay">calculateBackoffDelay</a></li><li><a href="global.html#createAndDeployVersion">createAndDeployVersion</a></li><li><a href="global.html#createBearerToken">createBearerToken</a></li><li><a href="global.html#createFromTemplate">createFromTemplate</a></li><li><a href="global.html#createFunction">createFunction</a></li><li><a href="global.html#createProjectFromTemplate">createProjectFromTemplate</a></li><li><a href="global.html#dev">dev</a></li><li><a href="global.html#displayRequestDetails">displayRequestDetails</a></li><li><a href="global.html#displayTroubleshootingHints">displayTroubleshootingHints</a></li><li><a href="global.html#displayValidationDetails">displayValidationDetails</a></li><li><a href="global.html#fetchAllLogs">fetchAllLogs</a></li><li><a href="global.html#fetchGfLogs">fetchGfLogs</a></li><li><a href="global.html#fetchLogs">fetchLogs</a></li><li><a href="global.html#formatEnvVars">formatEnvVars</a></li><li><a href="global.html#formatErrorForDisplay">formatErrorForDisplay</a></li><li><a href="global.html#getAllFilesInDir">getAllFilesInDir</a></li><li><a href="global.html#getProjectTemplate">getProjectTemplate</a></li><li><a href="global.html#getTemplate">getTemplate</a></li><li><a href="global.html#getTemplateDefaultVars">getTemplateDefaultVars</a></li><li><a href="global.html#getTemplateEnvVars">getTemplateEnvVars</a></li><li><a href="global.html#handleError">handleError</a></li><li><a href="global.html#initCommand">initCommand</a></li><li><a href="global.html#interactiveEnvVars">interactiveEnvVars</a></li><li><a href="global.html#invokeFunction">invokeFunction</a></li><li><a href="global.html#isRetryable">isRetryable</a></li><li><a href="global.html#listEnvVars">listEnvVars</a></li><li><a href="global.html#listFunctions">listFunctions</a></li><li><a href="global.html#listProjectTemplates">listProjectTemplates</a></li><li><a href="global.html#listTemplates">listTemplates</a></li><li><a href="global.html#listTemplatesCommand">listTemplatesCommand</a></li><li><a href="global.html#main">main</a></li><li><a href="global.html#makeApiRequest">makeApiRequest</a></li><li><a href="global.html#onInvoke">onInvoke</a></li><li><a href="global.html#parseAndValidateJson">parseAndValidateJson</a></li><li><a href="global.html#parseVariables">parseVariables</a></li><li><a href="global.html#replaceVariables">replaceVariables</a></li><li><a href="global.html#routeCommand">routeCommand</a></li><li><a href="global.html#runCLI">runCLI</a></li><li><a href="global.html#showDebug">showDebug</a></li><li><a href="global.html#showError">showError</a></li><li><a href="global.html#showInfo">showInfo</a></li><li><a href="global.html#showSuccess">showSuccess</a></li><li><a href="global.html#showWarning">showWarning</a></li><li><a href="global.html#sleep">sleep</a></li><li><a href="global.html#updateEnvVars">updateEnvVars</a></li><li><a href="global.html#updateFunction">updateFunction</a></li><li><a href="global.html#validateApiConfiguration">validateApiConfiguration</a></li><li><a href="global.html#validateDateString">validateDateString</a></li><li><a href="global.html#validateEnvironmentVariables">validateEnvironmentVariables</a></li><li><a href="global.html#validateFilePath">validateFilePath</a></li><li><a href="global.html#validateFunctionId">validateFunctionId</a></li><li><a href="global.html#validateFunctionName">validateFunctionName</a></li><li><a href="global.html#validateInput">validateInput</a></li><li><a href="global.html#validateTemplateVariables">validateTemplateVariables</a></li><li><a href="global.html#withRetry">withRetry</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
