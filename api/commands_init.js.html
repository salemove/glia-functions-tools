<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: commands/init.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: commands/init.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Command to initialize a new function project
 *
 * This command creates a new project from a template
 */
import path from 'path';
import fs from 'fs';
import { fileURLToPath } from 'url';
import { 
  listProjectTemplates, 
  getProjectTemplate, 
  createProjectFromTemplate,
  validateTemplateVariables,
  getTemplateDefaultVars
} from '../utils/project-template-manager.js';
import BaseCommand from '../cli/base-command.js';

/**
 * Initialize a new project from template
 * 
 * @param {Object} options - Command options
 * @param {string} options.template - Template name to use
 * @param {string} options.output - Output directory
 * @param {Object} options.variables - Template variables
 * @returns {Promise&lt;Object>} Results of initialization
 */
export async function initCommand(options) {
  try {
    // Handle list templates option
    if (options.listTemplates) {
      console.log('Fetching available project templates...');
      const templates = await listProjectTemplates();
      
      if (templates.length === 0) {
        console.log('No project templates available');
      } else {
        console.log('\nAvailable project templates:');
        templates.forEach(template => {
          console.log(`- ${template.displayName}: ${template.description}`);
        });
      }
      
      return { templates };
    }
    
    // Validate required options
    if (!options.template) {
      throw new Error('Template name is required (use --template)');
    }
    
    // Check if template exists
    const template = await getProjectTemplate(options.template);
    
    // Determine output directory
    const outputDir = options.output || path.resolve(process.cwd(), template.name);
    
    // Check if output directory exists and is not empty
    if (fs.existsSync(outputDir) &amp;&amp; fs.readdirSync(outputDir).length > 0) {
      if (!options.force) {
        throw new Error(`Output directory "${outputDir}" already exists and is not empty. Use --force to overwrite.`);
      } else {
        console.log(`Warning: Output directory "${outputDir}" already exists. Files may be overwritten.`);
      }
    }
    
    // Get default variables
    const defaultVars = getTemplateDefaultVars(template);
    
    // Merge with provided variables
    const variables = { ...defaultVars, ...options.variables };
    
    // Validate variables
    const validation = validateTemplateVariables(template, variables);
    if (!validation.valid) {
      throw new Error(`Invalid template variables: ${validation.errors.join(', ')}`);
    }
    
    // Create project from template
    console.log(`Creating project from template "${template.displayName}"...`);
    const result = await createProjectFromTemplate(template.name, outputDir, variables);
    
    // Print results
    console.log(`\nProject created successfully in ${outputDir}`);
    console.log(`\nFiles created: ${result.files.filter(f => f.success).length}`);
    
    if (result.files.some(f => !f.success)) {
      console.log(`\nErrors: ${result.files.filter(f => !f.success).length}`);
      result.files.filter(f => !f.success).forEach(f => {
        console.log(`- ${f.file}: ${f.error}`);
      });
    }
    
    // Print post-init results
    if (result.postInit &amp;&amp; result.postInit.length > 0) {
      console.log('\nPost-initialization actions:');
      result.postInit.forEach(action => {
        if (action.success) {
          console.log(`- ✅ ${action.action}`);
        } else {
          console.log(`- ❌ ${action.action}: ${action.error}`);
        }
      });
    }
    
    // Print next steps
    console.log('\nNext steps:');
    console.log(`1. cd ${path.relative(process.cwd(), outputDir)}`);
    console.log('2. Review and edit the generated files');
    console.log('3. Run "npm install" if dependencies are not already installed');
    console.log('4. Follow the instructions in README.md');
    
    return result;
    
  } catch (error) {
    throw error;
  }
}

/**
 * Parse variables from a string
 * 
 * @param {string} str - Variables string (key1=value1,key2=value2)
 * @returns {Object} Parsed variables
 */
function parseVariables(str) {
  if (!str) return {};
  
  return str.split(',').reduce((vars, item) => {
    const [key, value] = item.split('=');
    if (key &amp;&amp; value) {
      vars[key.trim()] = value.trim();
    }
    return vars;
  }, {});
}

/**
 * Command handler when run directly from CLI
 */
async function main() {
  const command = new BaseCommand('init', 'Initialize a new function project from template')
    .option('--template &lt;template>', 'Template to use')
    .option('--output &lt;path>', 'Output directory')
    .option('--variables &lt;vars>', 'Template variables (key1=value1,key2=value2)', parseVariables)
    .option('--list-templates', 'List available templates')
    .option('--force', 'Force create even if directory exists', false)
    .action(async (options) => {
      try {
        await initCommand(options);
        command.success('Project initialization completed successfully');
      } catch (error) {
        command.error(`Failed to initialize project: ${error.message}`);
      }
    });
    
  command.parse(process.argv);
}

// Run if called directly
if (import.meta.url === `file://${process.argv[1]}`) {
  main();
}

export default initCommand;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-api.html">api</a></li><li><a href="module-config.html">config</a></li></ul><h3>Classes</h3><ul><li><a href="ApiError.html">ApiError</a></li><li><a href="AuthenticationError.html">AuthenticationError</a></li><li><a href="BaseCommand_BaseCommand.html">BaseCommand</a></li><li><a href="CircuitBreaker.html">CircuitBreaker</a></li><li><a href="ConfigurationError.html">ConfigurationError</a></li><li><a href="FunctionError.html">FunctionError</a></li><li><a href="GliaError.html">GliaError</a></li><li><a href="NetworkDetector.html">NetworkDetector</a></li><li><a href="NetworkError.html">NetworkError</a></li><li><a href="OfflineManager.html">OfflineManager</a></li><li><a href="OperationQueue.html">OperationQueue</a></li><li><a href="PersistentCacheStorage.html">PersistentCacheStorage</a></li><li><a href="RateLimitError.html">RateLimitError</a></li><li><a href="ResponseCache.html">ResponseCache</a></li><li><a href="ValidationError.html">ValidationError</a></li><li><a href="module-api.html">api</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CLIAuth">CLIAuth</a></li><li><a href="global.html#CLIBuildMenu">CLIBuildMenu</a></li><li><a href="global.html#CLICreateProfile">CLICreateProfile</a></li><li><a href="global.html#CLIDeleteProfile">CLIDeleteProfile</a></li><li><a href="global.html#CLIDeployFunction">CLIDeployFunction</a></li><li><a href="global.html#CLIDevFunction">CLIDevFunction</a></li><li><a href="global.html#CLIFunctionDetailsMenu">CLIFunctionDetailsMenu</a></li><li><a href="global.html#CLIFunctionInvoke">CLIFunctionInvoke</a></li><li><a href="global.html#CLIFunctionLogs">CLIFunctionLogs</a></li><li><a href="global.html#CLIFunctionVersion">CLIFunctionVersion</a></li><li><a href="global.html#CLIFunctionVersions">CLIFunctionVersions</a></li><li><a href="global.html#CLIInitProject">CLIInitProject</a></li><li><a href="global.html#CLIListFunctions">CLIListFunctions</a></li><li><a href="global.html#CLIListProfiles">CLIListProfiles</a></li><li><a href="global.html#CLIMainMenu">CLIMainMenu</a></li><li><a href="global.html#CLIManageEnvVars">CLIManageEnvVars</a></li><li><a href="global.html#CLINewFunction">CLINewFunction</a></li><li><a href="global.html#CLINewVersion">CLINewVersion</a></li><li><a href="global.html#CLIProfileMenu">CLIProfileMenu</a></li><li><a href="global.html#CLISetup">CLISetup</a></li><li><a href="global.html#CLISwitchProfile">CLISwitchProfile</a></li><li><a href="global.html#CLIUpdateEnvironment">CLIUpdateEnvironment</a></li><li><a href="global.html#CLIUpdateFunction">CLIUpdateFunction</a></li><li><a href="global.html#DEFAULT_CACHE_CONFIG">DEFAULT_CACHE_CONFIG</a></li><li><a href="global.html#DEFAULT_OFFLINE_CONFIG">DEFAULT_OFFLINE_CONFIG</a></li><li><a href="global.html#DEFAULT_RETRY_CONFIG">DEFAULT_RETRY_CONFIG</a></li><li><a href="global.html#calculateBackoffDelay">calculateBackoffDelay</a></li><li><a href="global.html#createAndDeployVersion">createAndDeployVersion</a></li><li><a href="global.html#createBearerToken">createBearerToken</a></li><li><a href="global.html#createFromTemplate">createFromTemplate</a></li><li><a href="global.html#createFunction">createFunction</a></li><li><a href="global.html#createProjectFromTemplate">createProjectFromTemplate</a></li><li><a href="global.html#dev">dev</a></li><li><a href="global.html#displayRequestDetails">displayRequestDetails</a></li><li><a href="global.html#displayTroubleshootingHints">displayTroubleshootingHints</a></li><li><a href="global.html#displayValidationDetails">displayValidationDetails</a></li><li><a href="global.html#fetchAllLogs">fetchAllLogs</a></li><li><a href="global.html#fetchGfLogs">fetchGfLogs</a></li><li><a href="global.html#fetchLogs">fetchLogs</a></li><li><a href="global.html#formatEnvVars">formatEnvVars</a></li><li><a href="global.html#formatErrorForDisplay">formatErrorForDisplay</a></li><li><a href="global.html#getAllFilesInDir">getAllFilesInDir</a></li><li><a href="global.html#getProjectTemplate">getProjectTemplate</a></li><li><a href="global.html#getTemplate">getTemplate</a></li><li><a href="global.html#getTemplateDefaultVars">getTemplateDefaultVars</a></li><li><a href="global.html#getTemplateEnvVars">getTemplateEnvVars</a></li><li><a href="global.html#handleError">handleError</a></li><li><a href="global.html#initCommand">initCommand</a></li><li><a href="global.html#interactiveEnvVars">interactiveEnvVars</a></li><li><a href="global.html#invokeFunction">invokeFunction</a></li><li><a href="global.html#isRetryable">isRetryable</a></li><li><a href="global.html#listEnvVars">listEnvVars</a></li><li><a href="global.html#listFunctions">listFunctions</a></li><li><a href="global.html#listProjectTemplates">listProjectTemplates</a></li><li><a href="global.html#listTemplates">listTemplates</a></li><li><a href="global.html#listTemplatesCommand">listTemplatesCommand</a></li><li><a href="global.html#main">main</a></li><li><a href="global.html#makeApiRequest">makeApiRequest</a></li><li><a href="global.html#onInvoke">onInvoke</a></li><li><a href="global.html#parseAndValidateJson">parseAndValidateJson</a></li><li><a href="global.html#parseVariables">parseVariables</a></li><li><a href="global.html#replaceVariables">replaceVariables</a></li><li><a href="global.html#routeCommand">routeCommand</a></li><li><a href="global.html#runCLI">runCLI</a></li><li><a href="global.html#showDebug">showDebug</a></li><li><a href="global.html#showError">showError</a></li><li><a href="global.html#showInfo">showInfo</a></li><li><a href="global.html#showSuccess">showSuccess</a></li><li><a href="global.html#showWarning">showWarning</a></li><li><a href="global.html#sleep">sleep</a></li><li><a href="global.html#updateEnvVars">updateEnvVars</a></li><li><a href="global.html#updateFunction">updateFunction</a></li><li><a href="global.html#validateApiConfiguration">validateApiConfiguration</a></li><li><a href="global.html#validateDateString">validateDateString</a></li><li><a href="global.html#validateEnvironmentVariables">validateEnvironmentVariables</a></li><li><a href="global.html#validateFilePath">validateFilePath</a></li><li><a href="global.html#validateFunctionId">validateFunctionId</a></li><li><a href="global.html#validateFunctionName">validateFunctionName</a></li><li><a href="global.html#validateInput">validateInput</a></li><li><a href="global.html#validateTemplateVariables">validateTemplateVariables</a></li><li><a href="global.html#withRetry">withRetry</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
